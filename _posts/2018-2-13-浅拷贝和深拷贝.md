---
layout: post
title:  "js浅拷贝和深拷贝"
categories: JavaScript
tags: JavaScript
excerpt: 关于浅拷贝和深拷贝这个问题，刚接触的时候就感觉似懂非懂，今天来总结一下。
---



## 一、浅拷贝

> 简单来说，浅拷贝是指复制对象的时候，**只对第一层键值对进行独立的复制**。
```
var obj = { a:1, arr: [1,2,3] };
var aimObj = {};
shallowCopy(obj,aimObj);

function shallowCopy(obj,aimObj) {
  var aimObj = aimObj || {};
  for (var prop in obj) {
    // 将obj中的第一层属性赋值到aimObj
      aimObj[prop] = obj[prop];
  }
  return aimObj;
}
// 由于a为基本类型，所以a是直接复制的；而arr是引用类型，所以它复制的时候就是复制引用了，所以被修改的时候，它也会改变
aimObj.a = 2;
console.log(obj.a); // 1
aimObj.arr.push(1);
console.log(obj.arr); // (4)[1, 2, 3, 1]

```
> 浅拷贝的问题：由于浅拷贝只是拷贝第一层，所以，如果第一次中还是有属性的值是对象，那么拷贝过去的依然是引用。

## 二、深拷贝
 
> 深拷贝，实际上就是完全的拷贝一份，**拷贝老对象的所有层**，对新对象的所有修改都不会影响到老对象。
>
>+ (1)Object.create();
>+ (2)**转json字符串的方法实现深拷贝**：先将一个对象转成json字符串，然后再从json字符串转回来
```
// 只有可以转成JSON格式的对象才可以这样用
// 所以只有 Number, String, Boolean, Array, 扁平对象
// 像function、RegExp对象这些没办法转成JSON的没办法用。
var obj = { a:1, arr: [1,2,3] };
var aimObj = JSON.parse(JSON.stringify(obj));
```
>+ (3)**递归方式实现深拷贝**：只需要判断属性是否为对象，如果是对象，则递归copy，不是对象则和以前一样
```
var obj = { a:1, arr: [1,2,3] };
var aimObj = {};
deepCopy(obj,aimObj);

function deepCopy(obj,aimObj) {
  var aimObj = aimObj || {};
  for (var prop in obj) {
    if (typeof obj[prop] == "object") {
      aimObj[prop] = (obj[prop].constructor === Array) ? [] : {}; 
      deepCopy(obj[prop],aimObj[prop]);
    } else {
      aimObj[prop] = obj[prop];
    }
  }
  return aimObj;
}

aimObj.a = 2;
console.log(obj.a); // 1
aimObj.arr.push(1);
console.log(obj.arr); // (3)[1, 2, 3]
```
>+ (4)jq $.extend()方法：把后面的对象全部合并到target上。**返回target**
```
// deep为可选的boolean，默认为默认为false。如果该值为true，则为深拷贝。
// target为可选的目标对象，如果不指定，默认为jq对象本身
// object为需要合并的对象
extend(deep,target,object1,object2,object3...);

// 浅拷贝
var obj1 = {name:"rock",age:20,sex:"man"};
var obj2 = {name:"twl",age:[1,2]};
var obj3 = $.extend(obj1,obj2);
// {name: "twl", age: Array(2), sex: "man"} {name: "twl", age: Array(2)} {name: "twl", age: Array(2), sex: "man"}
console.log(obj1,obj2,obj3);
obj1.age.push(1);
console.log(obj2); // [1, 2, 1]

// 深拷贝
var obj1 = {name:"rock",age:20,sex:"man"};
var obj2 = {name:"twl",age:[1,2]};
var obj3 = $.extend(true,obj1,obj2);
obj1.age.push(1);
console.log(obj2.age); // [1, 2]
```
